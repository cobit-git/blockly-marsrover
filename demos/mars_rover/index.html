<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google" value="notranslate">
  <title>Toy Finder</title>
  <link rel="stylesheet" href="style.css">
  <script src="/storage.js"></script>
  <script src="../../dist/blockly_compressed.js"></script>
  <script src="../../dist/blocks_compressed.js"></script>
  <script src="../../dist/javascript_compressed.js"></script>
  <script src="../../dist/python_compressed.js"></script>
  <script src="../../dist/php_compressed.js"></script>
  <script src="../../dist/lua_compressed.js"></script>
  <script src="../../dist/dart_compressed.js"></script>
  <!-- Object detecting -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/knn-classifier"></script>
 
  
  <!--<script src="../../blocks/blocks.js"></script>
  <script src="../../blocks/logic.js"></script>
  <script src="../../blocks/loops.js"></script>
  <script src="../../blocks/math.js"></script>
  <script src="../../blocks/text.js"></script>
  <script src="../../blocks/mars_rover.js"></script>
  <script src="../../blocks/lists.js"></script>
  <script src="../../blocks/colour.js"></script>
  <script src="../../blocks/variables.js"></script>
  <script src="../../blocks/procedures.js"></script>
  <script src="../../generators/javascript.js"></script>
  <script src="../../generators/javascript/logic.js"></script>
  <script src="../../generators/javascript/loops.js"></script>
  <script src="../../generators/javascript/math.js"></script>
  <script src="../../generators/javascript/text.js"></script>
  <script src="../../generators/javascript/lists.js"></script>
  <script src="../../generators/javascript/colour.js"></script>
  <script src="../../generators/javascript/variables.js"></script>
  <script src="../../generators/javascript/procedures.js"></script>-->


  <script src="code.js"></script>
</head>

<body>
  <!-- Temporal object detecting trigger -->
  <button id ="class-a">Add A</button>
  <button id ="class-b">Add B</button>
  <button id ="class-c">Add C</button>
  <div id="console"></div>
  <table>
    <thead>
      <tr>
        <td align="center" colspan="2"><h3>Rover Control</h3></th>
        <td align="center" colspan="2"><h3>Camera Control</h3></td>		
      </tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="2" align="center"><p>
          마스로버 컨트롤 채널 선택 : <select id="channles" ></select>
        </p><form></td>
        <td colspan="2" align="center"><p>
          카메라 채널 선택 : <select id="cam_channles" ></select>
        </p><form> </td>
      </tr>
      <tr>
        <td align="center"><button class="button" id="open"> Connect  </button></td>
        <td align="center"><button class="button" id="close">Disconnect</button></td>
        <td align="center"><button class="button" id="cam_open"> Connect  </button></td>
        <td align="center"><button class="button" id="cam_close">Disconnect</button></form></td>
      </tr>
      <tr>
        <td colspan="2" align="center"><img id="connectId" src="disconnected.png"></td>
        <td colspan="2" align="center"><img id="camConnectId" src="disconnected.png"></td>
      </tr>
      <tr>
        <td align="center" ><img id="wheelId" src="wheel.png"></td> 
        <td align="center" >
          <h4>Wheel Angle: <span id="numAngle"></span></h4>
        </td>
        <td align="center" >
          <h4>Camera Tilt: <span id="tiltAngle"></span></h4>
        </td>
        <td align="center" >
          <h4>Camera Pan: <span id="panAngle"></span></h4>
        </td>
        
      </tr>
      <tr><td align="center" colspan="4">
          <img id="target" style="display:inline;"/>
          <canvas id="canvas" ></canvas>
        </td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4" style="background-color: white;">jd edu</td>
      </tr>
    </tfoot>
  </table>
  <table width="100%" height="100%">
    <tr>
      <td>
        <h1><a href="https://developers.google.com/blockly/">Blockly</a>&rlm; &gt;
          <a href="../index.html">Demos</a>&rlm; &gt;
          <span id="title">...</span>
        </h1>
      </td>
      <td class="farSide">
        <select id="languageMenu"></select>
        <a class="privacyLink" href="https://policies.google.com/privacy">Privacy</a>
      </td>
    </tr>
    <tr>
      <td colspan=2>
        <table width="100%">
          <tr id="tabRow" height="1em">
            <td id="tab_blocks" class="tabon">...</td>
            <td class="tabmin tab_collapse">&nbsp;</td>
            <td id="tab_javascript" class="taboff tab_collapse">JavaScript</td>
            <td class="tabmin tab_collapse">&nbsp;</td>
            <td id="tab_python" class="taboff tab_collapse">Python</td>
            <td class="tabmin tab_collapse">&nbsp;</td>
            <td id="tab_php" class="taboff tab_collapse">PHP</td>
            <td class="tabmin tab_collapse">&nbsp;</td>
            <td id="tab_lua" class="taboff tab_collapse">Lua</td>
            <td class="tabmin tab_collapse">&nbsp;</td>
            <td id="tab_dart" class="taboff tab_collapse">Dart</td>
            <td class="tabmin tab_collapse">&nbsp;</td>
            <td id="tab_xml" class="taboff tab_collapse">XML</td>
            <td class="tabmin tab_collapse">&nbsp;</td>
            <td id="tab_json" class="taboff tab_collapse">JSON</td>
            <td class="tabmin">&nbsp;</td>
            <td id="tab_code" class="taboff">
              <select id="code_menu"></select>
            </td>
            <td class="tabmax">
              <button id="trashButton" class="notext" title="...">
                <img src='../../media/1x1.gif' class="trash icon21">
              </button>
              <button id="linkButton" class="notext" title="...">
                <img src='../../media/1x1.gif' class="link icon21">
              </button>
              <button id="runButton" class="notext primary" title="...">
                <img src='../../media/1x1.gif' class="run icon21">
              </button>
              <button id="open">Open Serial Port</button>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td height="99%" colspan=2 id="content_area">
      </td>
    </tr>
  </table>
  <div id="content_blocks" class="content"></div>
  <pre id="content_javascript" class="content prettyprint lang-js"></pre>
  <pre id="content_python" class="content prettyprint lang-py"></pre>
  <pre id="content_php" class="content prettyprint lang-php"></pre>
  <pre id="content_lua" class="content prettyprint lang-lua"></pre>
  <pre id="content_dart" class="content prettyprint lang-dart"></pre>
  <textarea id="content_xml" class="content" wrap="off"></textarea>
  <textarea id="content_json" class="content" wrap="off"></textarea>
  <script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>
    window.addEventListener("load", function(evt){
      console.log("load");
      let host = "cobot.center"
            let port = 8287;
      //let host = "192.168.0.77";
      //let port = 8277;
      //inputHost.value = host //디폴트
      if (window.location.protocol == 'https:') {
        //inputPort.value = 8276;
        port = 8287;
        //port = 8277
      } else {
        //inputPort.value = 8277;
        port = 8286;
        //port = 8276 
      }
      
      openChannels(host, port);
    });

    async function load_model(){
      console.log('loading moblienet...');
      net = await mobilenet.load();
      console.log('Successfully loaded model');
    }

    const addExample = async classId => {
      // Capture an image from the web camera.
      const img = await webcam.capture();
  
      // Get the intermediate activation of MobileNet 'conv_preds' and pass that
      // to the KNN classifier.
      const activation = net.infer(img, true);
  
      // Pass the intermediate activation to the classifier.
      classifier.addExample(activation, classId);
  
      // Dispose the tensor to release the memory.
      img.dispose();
    };

    // When clicking a button, add an example for that class.
    document.getElementById('class-a').addEventListener('click', () => addExample(0));
    document.getElementById('class-b').addEventListener('click', () => addExample(1));
    document.getElementById('class-c').addEventListener('click', () => addExample(2));

    const classifier = knnClassifier.create();
    load_model();

    var colinkWs;
    // motor control block
    var motor_speed = 0;
    // wait block 
    var wait_time = 0
    
    // Custom event: move_forward 
    const event_move_forward = new Event("move_forward")
    document.addEventListener("move_forward", e => {
      console.log("move forward "+ motor_speed);
      colinkWs.send("BU"+motor_speed+'Z');
    })

    // Custom event: move_forward 
    const event_rover_stop = new Event("rover_stop")
    document.addEventListener("rover_stop", e => {
      console.log("rover stop");
      colinkWs.send("STOP");
    })

    // To disable scroll for arrow keys and space key 
    function disableScroll() { 
      document.body.classList.add("stop-scrolling"); 
    } 
    let stopScroll = disableScroll();
    // To chabge control channel connect image 
    function connImgChange(status){
      if(status == "on"){
        console.log("connImgChang - on");
        $("#connectId").attr("src", "connected.png");
      }else if(status == "off"){
        console.log("connImgChang - off");
        $("#connectId").attr("src", "disconnected.png");
      }		
    }
    // To chabge camera channel connect image 
    function connCamImgChange(status){
      if(status == "on"){
        console.log("connImgChang - on");
        $("#camConnectId").attr("src", "connected.png");
      }else if(status == "off"){
        console.log("connImgChang - off");
        $("#camConnectId").attr("src", "disconnected.png");
      }		
    }
    // display wheel angle 
    function displayAngle(angle) {
      var number = angle;
      document.getElementById("numAngle").innerHTML = number;
      $("#wheelId").css("transform","rotate(" + (angle - 90) + "deg)");
      
    }
    // camera tilt angle 
    function displayTiltAngle(angle) {
      var number = angle;
      document.getElementById("tiltAngle").innerHTML = number;
    }
    // camera pan angle 
    function displayPanAngle(angle) {
      var number = angle;
      document.getElementById("panAngle").innerHTML = number;
    }

    // wheel pan tilt angle 
    let angle = 90;
    let tilt = 90;
    let pan = 90;

    displayAngle(angle);
    displayTiltAngle(tilt);
    displayPanAngle(pan);

    
    const channelMenu = document.querySelector('#channles')
    let channlesApiUrl = "";
    let saveChannle = []; //api로 받아온 채널 저장.
    let APIOption = {
              mode: "sub",
              channel: "btlb3pjpc98lsdbc0lj0",
              track: "colink",
              mime: 'video/jpeg'
          }

    const camChannelMenu = document.querySelector('#cam_channles')
    let camChannlesApiUrl = "";
    let camSaveChannle = []; //api로 받아온 채널 저장.
    let camAPIOption = {
              mode: "sub",
              channel: "btlb3pjpc98lsdbc0lj0",
              track: "colink",
              mime: 'video/jpeg'
          }


    var ws;
    function openChannels(host, port){
      
      //console.log("Try to open channels...")
      if (window.location.protocol == 'https:') {
        channlesApiUrl = `https://${host}:${port}/monitor/http/cmd?format=json&obj=channel&op=show`;
      } else {
        channlesApiUrl = `http://${host}:${port}/monitor/http/cmd?format=json&obj=channel&op=show`;
      }
      fetch(channlesApiUrl)
        .then(function (response) {
          return response.json()
        })
        .then(function (response) {
          response.map((state, index) => {
            const _option = document.createElement('option')
            option = _option
            saveChannle.push([state.name, state.id])
            option.text = state.name
            option.value = index
            channelMenu.append(option)
            APIOption.channel = saveChannle[0][1]
            if (response[index].state === 1) {
              option.text = option.text + "on using"
            }
          })
        });

      console.log("Try to open cam channels...")
      if (window.location.protocol == 'https:') {
        camChannlesApiUrl = `https://${host}:${port}/monitor/http/cmd?format=json&obj=channel&op=show`;
      } else {
        camChannlesApiUrl = `http://${host}:${port}/monitor/http/cmd?format=json&obj=channel&op=show`;
      }
      console.log(camChannlesApiUrl);
      fetch(camChannlesApiUrl)
        .then(function (response) {
          return response.json()
        })
        .then(function (response) {
          response.map((state, index) => {
            const _option = document.createElement('option')
            option = _option
            camSaveChannle.push([state.name, state.id])
            option.text = state.name
            option.value = index
            camChannelMenu.append(option)
            camAPIOption.channel = camSaveChannle[0][1]
            console.log(camAPIOption.channel)
            if (response[index].state === 1) {
              option.text = option.text + "on using"
            }
          })
        });
      
      // "Open" button onClick 
      document.getElementById("open").onclick = function (evt) {
        //colinkUrl = `ws://192.168.0.77:8276/pang/ws/sub?channel=ca6s906pjh63qlu2ahh0&track=colink`;
        //colinkUrl = `ws://cobot.center:8286/pang/ws/sub?channel=ca6s906pjh63qlu2ahh0&track=colink&mode=bundle`;
        if (window.location.protocol == 'https:') {
                      colinkUrl = `wss://${host}:${port}/pang/ws/${APIOption.mode}?channel=${APIOption.channel}&track=${APIOption.track}&mode=bundle`;
                  } else {
                      colinkUrl = `ws://${host}:${port}/pang/ws/${APIOption.mode}?channel=${APIOption.channel}&track=${APIOption.track}&mode=bundle`;
                  }
        
        colinkWs = new WebSocket(colinkUrl);
        colinkWs.onopen = function (evt) {
          connImgChange("on");
          console.log(colinkWs);
          if (colinkWs) {
            window.setInterval(() => {

              if (colinkWs != null){
                colinkWs.send("123")
              console.log("heart beat from web")
              }
              
            }, 5000)
            window.addEventListener("gamepadconnected", function (e) {
              console.log("Gamepad connected");
            });

          
            var down = false;

          

            function keyHandler(e){
              const key = event.key;
              
              if (down) return;
              down = true;
              console.log(e.keyCode, e.charCode);
              // Rover control
              if ((e.keyCode === 119) ||(e.keyCode === 87)) { // 'w' or 'W'  
                colinkWs.send("AU");
              }
              if ((e.keyCode === 97) || (e.keyCode === 65)) {  // 'a' or 'A' 
                angle -= 5;
                if (angle < 60){
                  angle = 60;
                }
                colinkWs.send("AL"+angle+'Z');
                displayAngle(angle);
              }
              if ((e.keyCode === 115) || (e.keyCode === 83)){  // 's' or 'S'
                colinkWs.send("AD");
              }
              if ((e.keyCode === 100) || (e.keyCode === 68)){  // 'd' or 'D'
                angle += 5;
                if (angle > 150){
                  angle = 150;
                }
                colinkWs.send("AR"+angle+'Z');
                displayAngle(angle);
              }
              if (e.keyCode === 32){  // 'Space'  stop rover 
                colinkWs.send("STOP");
                // Prevent space key to trigger 
                e.preventDefault();
              }
              switch(e.key){
                case  "ArrowLeft":
                  pan -= 5;
                  if (pan < 10){
                    pan = 10;
                  }
                  colinkWs.send("CL"+pan+'Z');
                  displayPanAngle(pan);
                  break;
                case  "ArrowRight":
                  pan += 5;
                  if (pan > 170){
                    pan = 170;
                  }
                  colinkWs.send("CR"+pan+'Z');
                  displayPanAngle(pan);
                  break;
                case  "ArrowUp":
                  tilt += 5;
                  if (tilt > 170){
                    tilt = 170;
                  }
                  colinkWs.send("CU"+tilt+'Z');
                  displayTiltAngle(tilt);
                  break;
                case  "ArrowDown":
                  tilt -= 5;
                  if (tilt < 10){
                    tilt = 10;
                  }
                  colinkWs.send("CD"+tilt+'Z');
                  displayTiltAngle(tilt);
                  break;
              }
            }

            function keyUpHandler(e){
              down = false;
            }

            document.addEventListener("keydown", keyHandler);
            document.addEventListener('keyup', keyUpHandler);
          }
        };
        colinkWs.onclose = function (evt) {
          connImgChange("off")
          document.removeEventListener("keydown", keyHandler);
          document.removeEventListener('keyup', keyUpHandler);
          colinkWs = null;
        };

        colinkWs.onmessage = function (evt) {
          //console.log(evt.data);
          if (typeof evt.data == "object") {
            draw(evt.data);
          } else if (typeof evt.data == "string") {
            // mimetype.innerHTML = `mime.Type = ${evt.data}`;
          } else {
            //print("RESPONSE: " + evt.data);
          }
        };
        colinkWs.onerror = function (evt) {
          
        };
        return false;
      };
      // "Close" button onClick 
      document.getElementById("close").onclick = function (evt) {
                  if (!colinkWs) {
                      return false;
                  }
                  if (colinkWs) {
          connImgChange("off")
          document.removeEventListener("keydown", keyHandler);
          document.removeEventListener('keyup', keyUpHandler);
                      colinkWs.close();
                  }
                  return false;
              };
      document.getElementById("cam_close").onclick = function(evt) {
        if (!ws) {
          return false;
        }
        connCamImgChange("off")
        ws.close();
        return false;
      };
      channelMenu.onchange = function (e) { //채널을 클릭했을 떄.
                  APIOption.channel = saveChannle[this.value][1];
        console.log(APIOption.channel, "control channel");

              }
      camChannelMenu.onchange = function (e) { //채널을 클릭했을 떄.
                  camAPIOption.channel = camSaveChannle[this.value][1];
        console.log(camAPIOption.channel, "cam channel");

              }
      document.getElementById("cam_open").onclick = function(evt) {
        if (window.location.protocol == 'https:') {
          wsurl = `wss://${host}:${port}/pang/ws/${camAPIOption.mode}?channel=${camAPIOption.channel}&track=<label>`;
        } else {
          wsurl = `ws://${host}:${port}/pang/ws/${camAPIOption.mode}?channel=${camAPIOption.channel}&track=<label>`;
        }
        
        ws = new WebSocket(wsurl);
        ws.binaryType = 'arraybuffer';

        ws.onopen = function(evt) {
          connCamImgChange("on");
          console.log(ws);
        }
        ws.onclose = function(evt) {
          ws = null;
          connCamImgChange("off");
        }
        ws.onmessage = function(evt) {
          // console.log(typeof evt.data)
          if (typeof evt.data == "object") {
            draw(evt.data)
          } else if (typeof evt.data == "string") {
            //mimetype.innerHTML = `mime.Type = ${evt.data}`
          } else {
            //print("RESPONSE: " + evt.data);
          }
        }
        ws.onerror = function(evt) {
          //print("ERROR: " + evt.data);
        }
        return false;
      };
      
    } // End of openChannels()
    
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
      let imageSize = {
        width : 800,
        height : 600
    }
    window.onload = () => {
        canvas.style.width = 800;
        canvas.style.height = 600;
    }
    function draw(data) {
      var arrayBufferView = new Uint8Array( data );
      var blob = new Blob( [ arrayBufferView ], { type: "image/jpeg" } );
      var urlCreator = window.URL || window.webkitURL;
      var imageUrl = urlCreator.createObjectURL( blob );

      var img  = new Image();

      var imageData = imageUrl  //'data:image/jpeg;base64,' + Json;
      img.src = imageData;
      //console.log(blob.size)
      if (blob.size > 20000 && blob.size < 75000) {
        imageSize.width = 800;
        imageSize.height = 600;
      }
      if (blob.size > 75000 && blob.size < 150000) { //HD
        imageSize.width = 1280;
        imageSize.height = 720;
      }
      if (blob.size > 150000 && blob.size < 190000) { //FHD
        imageSize.width = 1920;
        imageSize.height = 1080;
      }
      if (blob.size > 200000 && blob.size < 300000) { //QHD
        imageSize.width = 2560;
        imageSize.height = 1440;
      }

      img.onload = function(){
        canvas.style.width = imageSize.width*2;
        canvas.style.height = imageSize.height*2;
        canvas.width = imageSize.width;
        canvas.height = imageSize.height;
        
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.save();
        // move to the center of the canvas
        //ctx.translate(canvas.width/2,canvas.height/2);

        // rotate the canvas to the specified degrees
        //tx.rotate(270*Math.PI/180);
        ctx.drawImage(img,-100, -200,imageSize.width,imageSize.height);
        ctx.restore();
      };
        }  // end of draw()
  </script>

  <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
    <category name="Mars Rover control" colour=200>
      <block type="move_forward">
      </block>
      <block type="rover_stop">
      </block>
      <block type="wait_mili_sec">
      </block>
    </category>
    
    <category name="%{BKY_CATLOGIC}" colour="%{BKY_LOGIC_HUE}">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null"></block>
      <block type="logic_ternary"></block>
    </category>
    <category name="%{BKY_CATLOOPS}" colour="%{BKY_LOOPS_HUE}">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
        <value name="BY">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>
    <category name="%{BKY_CATMATH}" colour="%{BKY_MATH_HUE}">
      <block type="math_number">
        <field name="NUM">123</field>
      </block>
      <block type="math_arithmetic">
        <value name="A">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="B">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="math_single">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">9</field>
          </shadow>
        </value>
      </block>
      <block type="math_trig">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">45</field>
          </shadow>
        </value>
      </block>
      <block type="math_constant"></block>
      <block type="math_number_property">
        <value name="NUMBER_TO_CHECK">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="math_round">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">3.1</field>
          </shadow>
        </value>
      </block>
      <block type="math_on_list"></block>
      <block type="math_modulo">
        <value name="DIVIDEND">
          <shadow type="math_number">
            <field name="NUM">64</field>
          </shadow>
        </value>
        <value name="DIVISOR">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="math_constrain">
        <value name="VALUE">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="LOW">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="HIGH">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_int">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_float"></block>
      <block type="math_atan2">
        <value name="X">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="Y">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="%{BKY_CATTEXT}" colour="%{BKY_TEXTS_HUE}">
      <block type="text"></block>
      <block type="text_join"></block>
      <block type="text_append">
        <value name="TEXT">
          <shadow type="text"></shadow>
        </value>
      </block>
      <block type="text_length">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_isEmpty">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT"></field>
          </shadow>
        </value>
      </block>
      <block type="text_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
        <value name="FIND">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_charAt">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_getSubstring">
        <value name="STRING">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_changeCase">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_trim">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_print">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_prompt_ext">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="%{BKY_CATLISTS}" colour="%{BKY_LISTS_HUE}">
      <block type="lists_create_with">
        <mutation items="0"></mutation>
      </block>
      <block type="lists_create_with"></block>
      <block type="lists_repeat">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">5</field>
          </shadow>
        </value>
      </block>
      <block type="lists_length"></block>
      <block type="lists_isEmpty"></block>
      <block type="lists_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getIndex">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_setIndex">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getSublist">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_split">
        <value name="DELIM">
          <shadow type="text">
            <field name="TEXT">,</field>
          </shadow>
        </value>
      </block>
      <block type="lists_sort"></block>
    </category>
    <category name="%{BKY_CATCOLOUR}" colour="%{BKY_COLOUR_HUE}">
      <block type="colour_picker"></block>
      <block type="colour_random"></block>
      <block type="colour_rgb">
        <value name="RED">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
        <value name="GREEN">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="BLUE">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="colour_blend">
        <value name="COLOUR1">
          <shadow type="colour_picker">
            <field name="COLOUR">#ff0000</field>
          </shadow>
        </value>
        <value name="COLOUR2">
          <shadow type="colour_picker">
            <field name="COLOUR">#3333ff</field>
          </shadow>
        </value>
        <value name="RATIO">
          <shadow type="math_number">
            <field name="NUM">0.5</field>
          </shadow>
        </value>
      </block>
    </category>
    <sep></sep>
    <category name="%{BKY_CATVARIABLES}" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
    <category name="%{BKY_CATFUNCTIONS}" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE"></category>
  </xml>

</body>
</html>
